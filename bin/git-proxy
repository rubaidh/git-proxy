#!/usr/bin/env ruby

require 'socket'

host, port = ARGV

$stderr.puts "Connecting to #{host}:#{port}"
socket = TCPSocket.new(host, port)

$stdin.sync = $stdout.sync = socket.sync = true

loop do
  begin
    readable, writable, errorable = select([$stdin, socket])
    if readable.include?($stdin)
      data = $stdin.readpartial(1024)
      $stderr.puts "> " + data.inspect
      socket.write(data)
    elsif readable.include?(socket)
      data = socket.readpartial(1024)
      $stderr.puts "< " + data.inspect
      $stdout.write(data)
    end
  rescue EOFError
    break if $stdin.closed? && socket.closed?
  end
end
