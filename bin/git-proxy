#!/usr/bin/env ruby

require 'socket'

host, port = ARGV

$stderr.puts "Connecting to #{host}:#{port}"
socket = TCPSocket.new(host, port)

# Writer
writer = Thread.new do
  $stderr.puts "Starting writer"
  while data = $stdin.read(1) do
    $stderr.write("#{data}")
    socket.write(data)
  end
  $stderr.puts "\nWriter ended"
end

# Reader
reader = Thread.new do
  $stderr.puts "Starting reader"
  while data = socket.read(1) do
    $stderr.write "#{data}"
    $stdout.write data
  end
  $stderr.puts "\nReader ended"
end

writer.join
reader.join
